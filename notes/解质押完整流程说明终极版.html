<!DOCTYPE html><html><head>
      <title>è§£è´¨æŠ¼å®Œæ•´æµç¨‹è¯´æ˜ç»ˆæç‰ˆ</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/ybeetle/.vscode-server/extensions/shd101wyy.markdown-preview-enhanced-0.8.19/crossnote/dependencies/katex/katex.min.css">
      
      
      <script type="text/javascript" src="file:////home/ybeetle/.vscode-server/extensions/shd101wyy.markdown-preview-enhanced-0.8.19/crossnote/dependencies/mermaid/mermaid.min.js" charset="UTF-8"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="è§£è´¨æŠ¼å®Œæ•´æµç¨‹è¯´æ˜ç»ˆæç‰ˆ">è§£è´¨æŠ¼å®Œæ•´æµç¨‹è¯´æ˜ï¼ˆç»ˆæç‰ˆï¼‰ </h1>
<blockquote>
<p>æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ SYI è´¨æŠ¼ç³»ç»Ÿçš„è§£è´¨æŠ¼æµç¨‹ï¼Œé‡ç‚¹è§£æ <strong>Staking åˆçº¦çš„ SYI å‚¨å¤‡æœºåˆ¶</strong> å’Œ <strong>Recycle å¾ªç¯å›æ”¶æœºåˆ¶</strong></p>
</blockquote>
<hr>
<h2 id="ç›®å½•">ç›®å½• </h2>
<ol>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">æ ¸å¿ƒæ¦‚å¿µ</a></li>
<li><a href="#%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E5%9B%BE">å®Œæ•´æµç¨‹å›¾</a></li>
<li><a href="#%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4%E6%8B%86%E8%A7%A3">è¯¦ç»†æ­¥éª¤æ‹†è§£</a></li>
<li><a href="#recycle-%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">Recycle æœºåˆ¶æ·±åº¦è§£æ</a></li>
<li><a href="#%E4%B8%8E%E4%B8%BB%E6%B5%81-defi-%E9%A1%B9%E7%9B%AE%E5%AF%B9%E6%AF%94">ä¸ä¸»æµ DeFi é¡¹ç›®å¯¹æ¯”</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90">å®‰å…¨æ€§åˆ†æ</a></li>
<li><a href="#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E7%B4%A2%E5%BC%95">å…³é”®ä»£ç ç´¢å¼•</a></li>
</ol>
<hr>
<h2 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ </h2>
<h3 id="ä¸‰ä¸ªå…³é”®é—®é¢˜">ä¸‰ä¸ªå…³é”®é—®é¢˜ </h3>
<h4 id="q1-staking-åˆçº¦ä¸Šæœ‰-syi-å‚¨å¤‡å—">Q1: Staking åˆçº¦ä¸Šæœ‰ SYI å‚¨å¤‡å—ï¼Ÿ </h4>
<p><strong>ç­”ï¼šæœ‰ï¼</strong> Staking åˆçº¦å¿…é¡»é¢„å…ˆæŒæœ‰ SYI å‚¨å¤‡ï¼ˆé€šå¸¸åœ¨éƒ¨ç½²æ—¶è½¬å…¥ï¼‰ã€‚</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>åˆå§‹çŠ¶æ€ç¤ºä¾‹ï¼š
â”œâ”€ Staking åˆçº¦: 200,000 SYI ï¼ˆå‚¨å¤‡ï¼‰
â””â”€ Pair æµåŠ¨æ€§æ± : 4,000,000 SYI + 40,000 USDT
</code></pre><h4 id="q2-è§£è´¨æŠ¼æ—¶å–å‡ºçš„-162981-syi-ä»å“ªé‡Œæ¥">Q2: è§£è´¨æŠ¼æ—¶å–å‡ºçš„ 162,981 SYI ä»å“ªé‡Œæ¥ï¼Ÿ </h4>
<p><strong>ç­”ï¼šä» Staking åˆçº¦çš„ SYI å‚¨å¤‡ä¸­æ¥ã€‚</strong></p>
<p>ä»£ç ä½ç½®ï¼š<code>contracts/SYI-Staking/abstract/StakingBase.sol:922-950</code></p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">_swapSYIForReward</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> calculatedReward<span class="token punctuation">)</span> <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> syiBalanceBefore <span class="token operator">=</span> SYI<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æŸ¥è¯¢ Staking å‚¨å¤‡</span>

    <span class="token comment">// ç”¨ Staking çš„ SYI å‚¨å¤‡æ¢ USDT</span>
    ROUTER<span class="token punctuation">.</span><span class="token function">swapTokensForExactTokens</span><span class="token punctuation">(</span>
        calculatedReward<span class="token punctuation">,</span>      <span class="token comment">// éœ€è¦æ¢å–çš„ USDT æ•°é‡</span>
        maxSYIInput<span class="token punctuation">,</span>           <span class="token comment">// æœ€å¤šç”¨å¤šå°‘ SYI</span>
        swapPath<span class="token punctuation">,</span>              <span class="token comment">// [SYI, USDT]</span>
        <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment">// USDT è½¬åˆ° Staking åˆçº¦</span>
        block<span class="token punctuation">.</span>timestamp
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    syiTokensUsed <span class="token operator">=</span> syiBalanceBefore <span class="token operator">-</span> SYI<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿”å›å®é™…ä½¿ç”¨çš„ SYI æ•°é‡ï¼ˆä¾‹å¦‚ï¼š162,981ï¼‰</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="q3-ä¸ºä»€ä¹ˆéœ€è¦-recycle">Q3: ä¸ºä»€ä¹ˆéœ€è¦ Recycleï¼Ÿ </h4>
<p><strong>ç­”ï¼šä¸ºäº†è®© Staking åˆçº¦çš„ SYI å‚¨å¤‡æ°¸è¿œç”¨ä¸å®Œï¼Œå®ç°å¯æŒç»­è¿è¡Œã€‚</strong></p>
<hr>
<h2 id="å®Œæ•´æµç¨‹å›¾">å®Œæ•´æµç¨‹å›¾ </h2>
<h3 id="æµç¨‹å›¾-1-è§£è´¨æŠ¼--recycle-å®Œæ•´æµç¨‹">æµç¨‹å›¾ 1: è§£è´¨æŠ¼ + Recycle å®Œæ•´æµç¨‹ </h3>
<div class="mermaid">sequenceDiagram
    autonumber
    participant User as ç”¨æˆ·
    participant Staking as Staking åˆçº¦
    participant SYI as SYI ä»£å¸åˆçº¦
    participant Router as PancakeRouter
    participant Pair as æµåŠ¨æ€§æ± (Pair)

    Note over Staking,Pair: åˆå§‹çŠ¶æ€&lt;br/&gt;Staking: 200,000 SYI&lt;br/&gt;Pair: 4,000,000 SYI + 40,000 USDT

    User-&gt;&gt;Staking: unstake(stakeIndex)

    rect rgb(255, 245, 230)
        Note over Staking: é˜¶æ®µ 1: è®¡ç®—å¥–åŠ±
        Staking-&gt;&gt;Staking: _burn(stakeIndex)
        Note over Staking: è¿”å›:&lt;br/&gt;æœ¬é‡‘ = 1,000 USDT&lt;br/&gt;å¥–åŠ± = 1,563.1 USDT
    end

    rect rgb(230, 245, 255)
        Note over Staking,Pair: é˜¶æ®µ 2: å– SYI æ¢ USDTï¼ˆä½¿ç”¨ Staking å‚¨å¤‡ï¼‰

        Staking-&gt;&gt;SYI: balanceOf(Staking)
        SYI--&gt;&gt;Staking: 200,000 SYI âœ… å‚¨å¤‡å……è¶³

        Staking-&gt;&gt;Router: swapTokensForExactTokens(&lt;br/&gt;  éœ€è¦: 1,563.1 USDT&lt;br/&gt;  æœ€å¤šç”¨: 200,000 SYI&lt;br/&gt;)

        Note over Router: AMM è®¡ç®—:&lt;br/&gt;éœ€è¦çº¦ 162,981 SYI

        Router-&gt;&gt;SYI: transferFrom(Staking, Pair, 162,981)
        SYI-&gt;&gt;Pair: è½¬è´¦ 162,981 SYI
        Note over Pair: SYI balance:&lt;br/&gt;4,000,000 + 162,981&lt;br/&gt;= 4,162,981 SYI

        Router-&gt;&gt;Pair: swap(0, 1563.1, Staking)
        Pair--&gt;&gt;Staking: è½¬è´¦ 1,563.1 USDT

        Note over Staking: Staking ä½™é¢å˜åŒ–:&lt;br/&gt;SYI: 200,000 â†’ 37,019 âš ï¸&lt;br/&gt;USDT: + 1,563.1 âœ…
    end

    rect rgb(245, 255, 245)
        Note over Staking: é˜¶æ®µ 3: åˆ†é…å¥–åŠ±
        Staking-&gt;&gt;User: è½¬è´¦ 1,337.86 USDT (ç”¨æˆ·å‡€æ”¶ç›Š)
        Staking-&gt;&gt;User: è½¬è´¦ 28.155 USDT (Friend 5%)
        Staking-&gt;&gt;User: è½¬è´¦ 197.085 USDT (å›¢é˜Ÿ 35%)
    end

    rect rgb(255, 230, 230)
        Note over Staking,Pair: é˜¶æ®µ 4: ğŸ”¥ Recycle å›æ”¶ï¼ˆå…³é”®ï¼‰

        Staking-&gt;&gt;SYI: recycle(162,981)

        Note over SYI: æƒé™æ£€æŸ¥
        SYI-&gt;&gt;SYI: require(msg.sender == staking)

        SYI-&gt;&gt;Pair: balanceOf(Pair)
        Pair--&gt;&gt;SYI: 4,162,981 SYI

        Note over SYI: è®¡ç®—å®‰å…¨ä¸Šé™:&lt;br/&gt;maxRecyclable = 4,162,981 / 3&lt;br/&gt;= 1,387,660 SYI&lt;br/&gt;&lt;br/&gt;è¯·æ±‚ 162,981 &lt; ä¸Šé™ âœ…

        SYI-&gt;&gt;SYI: _update(Pair, Staking, 162,981)
        Note over SYI: ç›´æ¥ä¿®æ”¹ä½™é¢:&lt;br/&gt;Pair: 4,162,981 - 162,981 = 4,000,000&lt;br/&gt;Staking: 37,019 + 162,981 = 200,000 âœ…

        SYI-&gt;&gt;Pair: sync()
        Note over Pair: åŒæ­¥å‚¨å¤‡é‡:&lt;br/&gt;reserve_SYI = 4,000,000&lt;br/&gt;reserve_USDT = 38,436.9&lt;br/&gt;ä»·æ ¼é‡æ–°è®¡ç®— âœ…
    end

    Note over Staking,Pair: æœ€ç»ˆçŠ¶æ€&lt;br/&gt;Staking: 200,000 SYI âœ… æ¢å¤&lt;br/&gt;Pair: 4,000,000 SYI + 38,436.9 USDT&lt;br/&gt;ç”¨æˆ·è·å¾—: 1,337.86 USDT
</div><h3 id="æµç¨‹å›¾-2-èµ„é‡‘é—­ç¯ç¤ºæ„å›¾">æµç¨‹å›¾ 2: èµ„é‡‘é—­ç¯ç¤ºæ„å›¾ </h3>
<div class="mermaid">graph TB
    subgraph åˆå§‹éƒ¨ç½²
        D[éƒ¨ç½²æ—¶é¢„å……å€¼&lt;br/&gt;200,000 SYI]
        D --&gt; S1[Staking åˆçº¦&lt;br/&gt;å‚¨å¤‡: 200,000 SYI]
    end

    subgraph è§£è´¨æŠ¼æµç¨‹
        U1[ç”¨æˆ·è§£è´¨æŠ¼] --&gt; C1[è®¡ç®—å¥–åŠ±&lt;br/&gt;1,563.1 USDT]
        C1 --&gt; S2[Staking å–å‡º&lt;br/&gt;162,981 SYI]
        S2 --&gt; P1[è½¬å…¥ Pair]
        P1 --&gt; U2[æ¢å¾— 1,563.1 USDT]
        U2 --&gt; D1[åˆ†é…ç»™ç”¨æˆ·/å›¢é˜Ÿ]

        Note1[æ­¤æ—¶ Staking&lt;br/&gt;åªå‰© 37,019 SYI âš ï¸]
    end

    subgraph Recycleå›æ”¶
        D1 --&gt; R1[è°ƒç”¨ SYI.recycle&lt;br/&gt;162,981 SYI]
        R1 --&gt; P2[ä» Pair å–å›]
        P2 --&gt; S3[Staking ä½™é¢æ¢å¤&lt;br/&gt;200,000 SYI âœ…]
        S3 --&gt; SY1[è°ƒç”¨ Pair.sync&lt;br/&gt;åŒæ­¥å‚¨å¤‡é‡]
    end

    subgraph å¾ªç¯
        SY1 -.å¾ªç¯ä½¿ç”¨.-&gt; U1
    end

    style S1 fill:#e1f5e1
    style Note1 fill:#ffe1e1
    style S3 fill:#e1f5e1
    style R1 fill:#fff3e1
</div><h3 id="æµç¨‹å›¾-3-recycle-å†³ç­–æ ‘">æµç¨‹å›¾ 3: Recycle å†³ç­–æ ‘ </h3>
<div class="mermaid">flowchart TD
    Start[Staking.unstake&lt;br/&gt;å–å‡ºåéœ€è¦ recycle] --&gt; Check1{è°ƒç”¨è€…æ˜¯å¦&lt;br/&gt;Staking åˆçº¦?}

    Check1 --&gt;|å¦| Fail1[âŒ revert:&lt;br/&gt;Only staking contract]
    Check1 --&gt;|æ˜¯| GetBalance[è·å– Pair çš„ SYI ä½™é¢]

    GetBalance --&gt; Check2{Pair ä¸­æœ‰ SYI?}
    Check2 --&gt;|pairBalance = 0| Fail2[âŒ æ— æ³•å›æ”¶&lt;br/&gt;æ± å­ç©ºäº†]
    Check2 --&gt;|pairBalance &gt; 0| Calc[è®¡ç®—å®‰å…¨ä¸Šé™&lt;br/&gt;maxRecyclable = pairBalance / 3]

    Calc --&gt; Check3{è¯·æ±‚æ•°é‡ vs ä¸Šé™}
    Check3 --&gt;|è¯·æ±‚ â‰¤ ä¸Šé™| Full[âœ… å…¨é¢å›æ”¶&lt;br/&gt;recycleAmount = è¯·æ±‚æ•°é‡]
    Check3 --&gt;|è¯·æ±‚ &gt; ä¸Šé™| Partial[âš ï¸ éƒ¨åˆ†å›æ”¶&lt;br/&gt;recycleAmount = maxRecyclable]

    Full --&gt; Execute[æ‰§è¡Œ _update&lt;br/&gt;from: Pair&lt;br/&gt;to: Staking]
    Partial --&gt; Execute

    Execute --&gt; UpdateBalance[æ›´æ–°ä½™é¢:&lt;br/&gt;Pair -= recycleAmount&lt;br/&gt;Staking += recycleAmount]
    UpdateBalance --&gt; Sync[è°ƒç”¨ Pair.sync&lt;br/&gt;åŒæ­¥å‚¨å¤‡é‡]
    Sync --&gt; Done[âœ… å›æ”¶å®Œæˆ]

    style Fail1 fill:#ffcccc
    style Fail2 fill:#ffcccc
    style Full fill:#ccffcc
    style Partial fill:#ffffcc
    style Done fill:#99ff99
    style Execute fill:#e1f0ff
</div><h3 id="æµç¨‹å›¾-4-å¯¹æ¯”æœ‰æ— -recycle-çš„åŒºåˆ«">æµç¨‹å›¾ 4: å¯¹æ¯”æœ‰æ—  Recycle çš„åŒºåˆ« </h3>
<div class="mermaid">gantt
    title Staking SYI å‚¨å¤‡å˜åŒ–å¯¹æ¯”
    dateFormat X
    axisFormat %s

    section æ²¡æœ‰ Recycleï¼ˆä¼šè€—å°½ï¼‰
    åˆå§‹å‚¨å¤‡ 200,000 :done, 0, 1
    ç¬¬1æ¬¡è§£è´¨æŠ¼ -162,981 â†’ 37,019 :crit, 1, 2
    ç¬¬2æ¬¡è§£è´¨æŠ¼ æ— æ³•æ”¯ä»˜ âŒ :milestone, 2, 3

    section æœ‰ Recycleï¼ˆæ°¸ä¸è€—å°½ï¼‰
    åˆå§‹å‚¨å¤‡ 200,000 :done, 3, 4
    ç¬¬1æ¬¡å–å‡º â†’ 37,019 :active, 4, 4.3
    ç¬¬1æ¬¡å›æ”¶ â†’ 200,000 âœ… :milestone, 4.3, 5
    ç¬¬2æ¬¡å–å‡º â†’ 37,019 :active, 5, 5.3
    ç¬¬2æ¬¡å›æ”¶ â†’ 200,000 âœ… :milestone, 5.3, 6
    å¯æ— é™å¾ªç¯ â™¾ï¸ :done, 6, 7
</div><hr>
<h2 id="è¯¦ç»†æ­¥éª¤æ‹†è§£">è¯¦ç»†æ­¥éª¤æ‹†è§£ </h2>
<h3 id="æ­¥éª¤-1-è®¡ç®—å¥–åŠ±-_burn">æ­¥éª¤ 1: è®¡ç®—å¥–åŠ± (_burn) </h3>
<p><strong>ä»£ç ä½ç½®</strong>: <code>contracts/SYI-Staking/abstract/StakingBase.sol:897-920</code></p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">_burn</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> index<span class="token punctuation">)</span> <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> reward<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Record <span class="token keyword keyword-storage">storage</span> user_record <span class="token operator">=</span> userStakeRecord<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. æ£€æŸ¥è´¨æŠ¼æœŸé™</span>
    <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>
        block<span class="token punctuation">.</span>timestamp <span class="token operator">-</span> user_record<span class="token punctuation">.</span>stakeTime <span class="token operator">&gt;=</span> <span class="token function">getStakePeriod</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"Staking period not met"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. æ£€æŸ¥æ˜¯å¦å·²æç°</span>
    <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span><span class="token operator">!</span>user_record<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">"Already withdrawn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. è®¡ç®—å¤åˆ©å¥–åŠ±</span>
    amount <span class="token operator">=</span> user_record<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>           <span class="token comment">// æœ¬é‡‘: 1,000 USDT</span>
    reward <span class="token operator">=</span> <span class="token function">_calculateStakeReward</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å¥–åŠ±: 1,563.1 USDT (å«æœ¬é‡‘)</span>

    <span class="token comment">// 4. æ ‡è®°å·²æç°</span>
    user_record<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. é”€æ¯ sSYI ä»£å¸</span>
    <span class="token function">_update</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>è¾“å‡º</strong>:</p>
<ul>
<li><code>principalAmount</code>: 1,000 USDTï¼ˆæœ¬é‡‘ï¼‰</li>
<li><code>calculatedReward</code>: 1,563.1 USDTï¼ˆæœ¬é‡‘ + åˆ©æ¯ï¼‰</li>
</ul>
<hr>
<h3 id="æ­¥éª¤-2-å–-syi-æ¢-usdt-_swapsyiforreward">æ­¥éª¤ 2: å– SYI æ¢ USDT (_swapSYIForReward) </h3>
<p><strong>ä»£ç ä½ç½®</strong>: <code>contracts/SYI-Staking/abstract/StakingBase.sol:922-950</code></p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">_swapSYIForReward</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> calculatedReward<span class="token punctuation">)</span> <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. è®°å½• Staking åˆçº¦çš„ SYI ä½™é¢ï¼ˆå‚¨å¤‡ï¼‰</span>
    <span class="token builtin">uint256</span> syiBalanceBefore <span class="token operator">=</span> SYI<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¾‹å¦‚: 200,000 SYI</span>

    <span class="token comment">// 2. è®°å½• USDT ä½™é¢</span>
    <span class="token builtin">uint256</span> usdtBalanceBefore <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. è®¾ç½®äº¤æ˜“è·¯å¾„</span>
    <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword keyword-memory">memory</span> swapPath <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    swapPath<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>SYI<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å–å‡º SYI</span>
    swapPath<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¹°å…¥ USDT</span>

    <span class="token comment">// 4. è®¡ç®—æœ€å¤§å…è®¸ä½¿ç”¨çš„ SYI æ•°é‡ï¼ˆå«æ»‘ç‚¹ä¿æŠ¤ï¼‰</span>
    <span class="token builtin">uint256</span> maxSYIInput <span class="token operator">=</span> <span class="token function">_calculateMaxSYIInput</span><span class="token punctuation">(</span>
        calculatedReward<span class="token punctuation">,</span>      <span class="token comment">// éœ€è¦ 1,563.1 USDT</span>
        syiBalanceBefore       <span class="token comment">// å¯ç”¨ 200,000 SYI</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. æ‰§è¡Œäº¤æ˜“ï¼šç²¾ç¡®æ¢å–æŒ‡å®šæ•°é‡çš„ USDT</span>
    ROUTER<span class="token punctuation">.</span><span class="token function">swapTokensForExactTokens</span><span class="token punctuation">(</span>
        calculatedReward<span class="token punctuation">,</span>      <span class="token comment">// ç²¾ç¡®éœ€è¦: 1,563.1 USDT</span>
        maxSYIInput<span class="token punctuation">,</span>           <span class="token comment">// æœ€å¤šç”¨: ~250,000 SYI (å«æ»‘ç‚¹)</span>
        swapPath<span class="token punctuation">,</span>              <span class="token comment">// [SYI, USDT]</span>
        <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment">// USDT è½¬åˆ° Staking åˆçº¦</span>
        block<span class="token punctuation">.</span>timestamp        <span class="token comment">// æˆªæ­¢æ—¶é—´</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6. è®¡ç®—å®é™…ä½¿ç”¨äº†å¤šå°‘ SYI</span>
    <span class="token builtin">uint256</span> syiBalanceAfter <span class="token operator">=</span> SYI<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    syiTokensUsed <span class="token operator">=</span> syiBalanceBefore <span class="token operator">-</span> syiBalanceAfter<span class="token punctuation">;</span>  <span class="token comment">// ä¾‹å¦‚: 162,981 SYI</span>

    <span class="token comment">// 7. è®¡ç®—å®é™…æ¢å¾—å¤šå°‘ USDT</span>
    usdtReceived <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> usdtBalanceBefore<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>usdtReceived<span class="token punctuation">,</span> syiTokensUsed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… ä½¿ç”¨ <code>swapTokensForExactTokens</code>ï¼šç²¾ç¡®æ¢å–æ‰€éœ€ USDTï¼Œé¿å…è®¡ç®—è¯¯å·®</li>
<li>âœ… SYI æ¥è‡ª Staking åˆçº¦çš„<strong>é¢„å……å€¼å‚¨å¤‡</strong></li>
<li>âœ… äº¤æ˜“å Staking çš„ SYI ä½™é¢ä¼šå¤§å¹…å‡å°‘ï¼ˆ200,000 â†’ 37,019ï¼‰</li>
</ul>
<p><strong>ä½™é¢å˜åŒ–</strong>ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>äº¤æ˜“å‰:
â”œâ”€ Staking: 200,000 SYI + 0 USDT
â””â”€ Pair: 4,000,000 SYI + 40,000 USDT

äº¤æ˜“å:
â”œâ”€ Staking: 37,019 SYI + 1,563.1 USDT  âš ï¸ SYI å‚¨å¤‡å¤§å¹…å‡å°‘
â””â”€ Pair: 4,162,981 SYI + 38,436.9 USDT
</code></pre><hr>
<h3 id="æ­¥éª¤-3-åˆ†é…å¥–åŠ±">æ­¥éª¤ 3: åˆ†é…å¥–åŠ± </h3>
<p><strong>ä»£ç ä½ç½®</strong>: <code>contracts/SYI-Staking/abstract/StakingBase.sol:208-258</code></p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">unstake</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> stakeIndex<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... å‰é¢è·å¾—äº† usdtReceived = 1,563.1 USDT</span>

    <span class="token comment">// 1. è®¡ç®—åˆ©æ¯</span>
    <span class="token builtin">uint256</span> interestEarned <span class="token operator">=</span> usdtReceived <span class="token operator">-</span> principalAmount<span class="token punctuation">;</span>  <span class="token comment">// 563.1 USDT</span>

    <span class="token comment">// 2. Friend å¥–åŠ± (5%)</span>
    <span class="token builtin">uint256</span> friendReward <span class="token operator">=</span> <span class="token function">_distributeFriendReward</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> interestEarned<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// = 563.1 * 5% = 28.155 USDT</span>

    <span class="token comment">// 3. å›¢é˜Ÿå¥–åŠ± (35%)</span>
    <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword keyword-memory">memory</span> referralChain <span class="token operator">=</span> <span class="token function">getReferrals</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">uint256</span> teamFee <span class="token operator">=</span> <span class="token function">_distributeTeamReward</span><span class="token punctuation">(</span>referralChain<span class="token punctuation">,</span> interestEarned<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// = 563.1 * 35% = 197.085 USDT</span>

    <span class="token comment">// 4. æ›´æ–°å›¢é˜Ÿ KPI</span>
    <span class="token function">_updateTeamInvestmentValues</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> principalAmount<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. è®¡ç®—ç”¨æˆ·å®é™…æ”¶ç›Š</span>
    <span class="token builtin">uint256</span> userPayout <span class="token operator">=</span> usdtReceived <span class="token operator">-</span> friendReward <span class="token operator">-</span> teamFee<span class="token punctuation">;</span>
    <span class="token comment">// = 1,563.1 - 28.155 - 197.085 = 1,337.86 USDT</span>

    <span class="token comment">// 6. èµå›è´¹ (1%)</span>
    <span class="token builtin">uint256</span> redemptionFee <span class="token operator">=</span> <span class="token punctuation">(</span>userPayout <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10000</span><span class="token punctuation">;</span>  <span class="token comment">// 1% = 13.38 USDT</span>

    <span class="token comment">// 7. è½¬è´¦ç»™ç”¨æˆ·</span>
    <span class="token function">IERC20</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> userPayout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ... æ¥ä¸‹æ¥æ˜¯ Recycle</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>åˆ†é…æ˜ç»†</strong>ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>æ€»å¥–åŠ±: 1,563.1 USDT
â”œâ”€ æœ¬é‡‘: 1,000 USDT
â”œâ”€ åˆ©æ¯: 563.1 USDT
    â”œâ”€ Friend (5%): 28.155 USDT
    â”œâ”€ å›¢é˜Ÿ (35%): 197.085 USDT
    â””â”€ ç”¨æˆ·å‰©ä½™: 1,337.86 USDT
        â””â”€ èµå›è´¹ (1%): 13.38 USDT (è½¬ç»™ feeRecipient)
</code></pre><hr>
<h3 id="æ­¥éª¤-4-recycle-å›æ”¶-syi">æ­¥éª¤ 4: Recycle å›æ”¶ SYI </h3>
<p><strong>ä»£ç ä½ç½®</strong>: <code>contracts/SYI/abstract/SYIBase.sol:405-505</code></p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">recycle</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token comment">// ===== 1. æƒé™æ£€æŸ¥ =====</span>
    <span class="token comment">// åªå…è®¸ Staking åˆçº¦è°ƒç”¨ï¼Œé˜²æ­¢ä»»æ„åœ°å€æŠ½å–æµåŠ¨æ€§</span>
    <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span>staking<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Only staking contract"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ===== 2. è·å–æ± å­çš„ SYI å®é™…ä½™é¢ =====</span>
    <span class="token comment">// æ³¨æ„ï¼šè¿™é‡Œè¯»å–çš„æ˜¯ balance (å®é™…ä½™é¢)ï¼Œä¸æ˜¯ reserve (è´¦é¢å‚¨å¤‡)</span>
    <span class="token builtin">uint256</span> pairBalance <span class="token operator">=</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>uniswapV2Pair<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¾‹å¦‚: 4,162,981 SYI</span>

    <span class="token comment">// ===== 3. è®¡ç®—å®‰å…¨ä¸Šé™ (1/3 è§„åˆ™) =====</span>
    <span class="token comment">// ä¸ºä»€ä¹ˆæ˜¯ 1/3ï¼Ÿé˜²æ­¢ä¸€æ¬¡æ€§æŠ½ç©ºæ± å­ï¼Œä¿è¯æµåŠ¨æ€§</span>
    <span class="token builtin">uint256</span> maxRecyclable <span class="token operator">=</span> pairBalance <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¾‹å¦‚: 4,162,981 / 3 = 1,387,660 SYI</span>

    <span class="token comment">// ===== 4. ç¡®å®šå®é™…å›æ”¶æ•°é‡ =====</span>
    <span class="token builtin">uint256</span> recycleAmount <span class="token operator">=</span> amount <span class="token operator">&gt;=</span> maxRecyclable
        <span class="token operator">?</span> maxRecyclable   <span class="token comment">// è¯·æ±‚è¿‡å¤šï¼ŒæŒ‰ä¸Šé™å›æ”¶</span>
        <span class="token punctuation">:</span> amount<span class="token punctuation">;</span>         <span class="token comment">// è¯·æ±‚åˆç†ï¼ŒæŒ‰éœ€å›æ”¶</span>
    <span class="token comment">// ä¾‹å¦‚: è¯·æ±‚ 162,981 &lt; ä¸Šé™ 1,387,660 âœ…ï¼Œå›æ”¶ 162,981</span>

    <span class="token comment">// ===== 5. æ‰§è¡Œå›æ”¶æ“ä½œ =====</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>recycleAmount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 5.1 ç›´æ¥ä¿®æ”¹ä½™é¢ï¼ˆä¸èµ° transferï¼Œé¿å…è§¦å‘ç¨è´¹é€»è¾‘ï¼‰</span>
        <span class="token function">_update</span><span class="token punctuation">(</span>
            <span class="token builtin">address</span><span class="token punctuation">(</span>uniswapV2Pair<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// from: Pair åœ°å€</span>
            <span class="token builtin">address</span><span class="token punctuation">(</span>staking<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">// to: Staking åœ°å€</span>
            recycleAmount            <span class="token comment">// amount: 162,981 SYI</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ­¤æ—¶ä½™é¢å˜åŒ–:</span>
        <span class="token comment">// Pair: 4,162,981 - 162,981 = 4,000,000 SYI âœ… æ¢å¤</span>
        <span class="token comment">// Staking: 37,019 + 162,981 = 200,000 SYI âœ… æ¢å¤</span>

        <span class="token comment">// 5.2 åŒæ­¥ Pair çš„å‚¨å¤‡é‡ï¼ˆå…³é”®ï¼ï¼‰</span>
        uniswapV2Pair<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// sync() çš„ä½œç”¨:</span>
        <span class="token comment">// - å°† reserve (è´¦é¢) æ›´æ–°ä¸º balance (å®é™…)</span>
        <span class="token comment">// - ç¡®ä¿ AMM ä»·æ ¼è®¡ç®—æ­£ç¡®</span>
        <span class="token comment">// - é˜²æ­¢å¥—åˆ©æ”»å‡»</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>ä¸ºä»€ä¹ˆå¿…é¡»è°ƒç”¨ sync()ï¼Ÿ</strong></p>
<p>Uniswap V2 çš„ä»·æ ¼åŸºäº <code>reserve</code>ï¼ˆè´¦é¢å‚¨å¤‡é‡ï¼‰ï¼Œè€Œä¸æ˜¯ <code>balance</code>ï¼ˆå®é™…ä½™é¢ï¼‰ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>é—®é¢˜ï¼šrecycle ç›´æ¥ä¿®æ”¹äº† balanceï¼Œä½† reserve è¿˜æ˜¯æ—§çš„

ä¿®æ”¹å‰:
â”œâ”€ Pair balance: 4,162,981 SYI (å®é™…ä½™é¢)
â””â”€ Pair reserve: 4,162,981 SYI (è´¦é¢å‚¨å¤‡) âœ… ä¸€è‡´

recycle å (æœª sync):
â”œâ”€ Pair balance: 4,000,000 SYI (å®é™…ä½™é¢)
â””â”€ Pair reserve: 4,162,981 SYI (è´¦é¢å‚¨å¤‡) âŒ ä¸ä¸€è‡´

åæœ:
â”œâ”€ AMM ä»·æ ¼è®¡ç®—é”™è¯¯ï¼ˆåŸºäºæ—§çš„ reserveï¼‰
â”œâ”€ K å€¼éªŒè¯å¤±è´¥ï¼ˆreserve0 * reserve1 != kï¼‰
â””â”€ ä¸‹ä¸€ç¬”äº¤æ˜“ä¼š revert

è°ƒç”¨ sync() å:
â”œâ”€ Pair balance: 4,000,000 SYI
â””â”€ Pair reserve: 4,000,000 SYI âœ… é‡æ–°ä¸€è‡´
</code></pre><p><strong>sync() æºç </strong> (Uniswap V2):</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token keyword keyword-function">function</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token function">_update</span><span class="token punctuation">(</span>
        <span class="token function">IERC20</span><span class="token punctuation">(</span>token0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">IERC20</span><span class="token punctuation">(</span>token1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        reserve0<span class="token punctuation">,</span>
        reserve1
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä½œç”¨: å¼ºåˆ¶å°† reserve æ›´æ–°ä¸ºå½“å‰ balance</span>
</code></pre><hr>
<h2 id="recycle-æœºåˆ¶æ·±åº¦è§£æ">Recycle æœºåˆ¶æ·±åº¦è§£æ </h2>
<h3 id="æ ¸å¿ƒé—®é¢˜ä¸ºä»€ä¹ˆéœ€è¦-recycle">æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦ Recycleï¼Ÿ </h3>
<h4 id="åœºæ™¯å¯¹æ¯”">åœºæ™¯å¯¹æ¯” </h4>
<p><strong>åœºæ™¯ Aï¼šæ²¡æœ‰ Recycleï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>åˆå§‹çŠ¶æ€:
â””â”€ Staking: 200,000 SYI å‚¨å¤‡

ç¬¬ 1 æ¬¡è§£è´¨æŠ¼:
â”œâ”€ ç”¨æˆ· A æç°ï¼Œå–å‡º 162,981 SYI
â”œâ”€ Staking ä½™é¢: 200,000 - 162,981 = 37,019 SYI âš ï¸
â””â”€ å‰©ä½™å‚¨å¤‡: 37,019 SYI

ç¬¬ 2 æ¬¡è§£è´¨æŠ¼:
â”œâ”€ ç”¨æˆ· B æç°ï¼Œéœ€è¦å–å‡º ~160,000 SYI
â”œâ”€ ä½† Staking åªæœ‰ 37,019 SYIï¼
â””â”€ âŒ äº¤æ˜“å¤±è´¥ï¼Œç³»ç»Ÿå´©æºƒ

è§£å†³æ–¹æ¡ˆ:
â””â”€ éœ€è¦å®šæœŸæ‰‹åŠ¨è¡¥å…… SYI å‚¨å¤‡ï¼ˆè¿è¥æˆæœ¬é«˜ï¼‰
</code></pre><p><strong>åœºæ™¯ Bï¼šæœ‰ Recycleï¼ˆåˆ›æ–°æ¨¡å¼ï¼‰</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>åˆå§‹çŠ¶æ€:
â””â”€ Staking: 200,000 SYI å‚¨å¤‡

ç¬¬ 1 æ¬¡è§£è´¨æŠ¼:
â”œâ”€ 1. ç”¨æˆ· A æç°ï¼Œå–å‡º 162,981 SYI
â”‚   Staking ä½™é¢: 37,019 SYI âš ï¸
â”œâ”€ 2. è°ƒç”¨ recycle(162,981)
â”‚   ä» Pair å–å› 162,981 SYI
â””â”€ 3. Staking ä½™é¢: 37,019 + 162,981 = 200,000 SYI âœ…

ç¬¬ 2 æ¬¡è§£è´¨æŠ¼:
â”œâ”€ Staking ä¾ç„¶æœ‰ 200,000 SYI âœ…
â”œâ”€ å¯ä»¥æ­£å¸¸å¤„ç†æç°
â””â”€ å†æ¬¡ recycleï¼Œç»§ç»­å¾ªç¯

ç¬¬ N æ¬¡è§£è´¨æŠ¼:
â””â”€ ç†è®ºä¸Šå¯ä»¥æ— é™å¾ªç¯ â™¾ï¸
</code></pre><h3 id="recycle-çš„æœ¬è´¨">Recycle çš„æœ¬è´¨ </h3>
<p><strong>Recycle ä¸æ˜¯"åˆ›é€ " SYIï¼Œè€Œæ˜¯"å€Ÿç”¨å¹¶å½’è¿˜"</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Staking éœ€è¦ USDT æ”¯ä»˜å¥–åŠ±              â”‚
â”‚         â†“                               â”‚
â”‚ ä½† Staking åªæœ‰ SYI å‚¨å¤‡                â”‚
â”‚         â†“                               â”‚
â”‚ 1. ç”¨ SYI åœ¨ DEX ä¸Šæ¢ USDT ï¼ˆå–å‡ºï¼‰    â”‚
â”‚         â†“                               â”‚
â”‚ 2. SYI æš‚æ—¶ç•™åœ¨ Pair ä¸­                â”‚
â”‚         â†“                               â”‚
â”‚ 3. Recycle æŠŠ SYI æ‹¿å›æ¥ ï¼ˆå½’è¿˜ï¼‰      â”‚
â”‚         â†“                               â”‚
â”‚ Staking çš„ SYI å‚¨å¤‡æ¢å¤ âœ…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç†è§£:
â”œâ”€ SYI åªæ˜¯"åª’ä»‹è´§å¸"ï¼Œä¸æ˜¯å¥–åŠ±æœ¬èº«
â”œâ”€ çœŸæ­£çš„å¥–åŠ±æ˜¯ USDTï¼ˆæ¥è‡ªåç»­ç”¨æˆ·è´¨æŠ¼ï¼‰
â””â”€ Recycle è®© SYI å¾ªç¯ä½¿ç”¨ï¼Œä¸ä¼šæ¶ˆè€—
</code></pre><h3 id="å®‰å…¨ä¸Šé™ä¸ºä»€ä¹ˆåªèƒ½å›æ”¶-13">å®‰å…¨ä¸Šé™ï¼šä¸ºä»€ä¹ˆåªèƒ½å›æ”¶ 1/3ï¼Ÿ </h3>
<p><strong>ä»£ç </strong>: <code>uint256 maxRecyclable = pairBalance / 3;</code></p>
<p><strong>åŸå› åˆ†æ</strong>:</p>
<ol>
<li>
<p><strong>ä¿æŠ¤æµåŠ¨æ€§æ·±åº¦</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>å¦‚æœå…è®¸å…¨éƒ¨å›æ”¶:
â”œâ”€ Pair ä¸­ SYI è¢«æŠ½ç©º
â”œâ”€ æµåŠ¨æ€§å½’é›¶
â””â”€ ç”¨æˆ·æ— æ³•äº¤æ˜“ âŒ

é™åˆ¶ 1/3:
â”œâ”€ Pair è‡³å°‘ä¿ç•™ 2/3 çš„ SYI
â”œâ”€ ä¿è¯ç”¨æˆ·å¯ä»¥æ­£å¸¸ä¹°å–
â””â”€ ä»·æ ¼ä¸ä¼šå‰§çƒˆæ³¢åŠ¨ âœ…
</code></pre></li>
<li>
<p><strong>é˜²æ­¢ä»·æ ¼æ“çºµ</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>æ¶æ„æ”»å‡»åœºæ™¯:
â”œâ”€ æ”»å‡»è€…å¤§é‡ä¹°å…¥ SYIï¼ˆæ¨é«˜ä»·æ ¼ï¼‰
â”œâ”€ Pair ä¸­ SYI ä½™é¢å¢åŠ 
â”œâ”€ å¦‚æœå…è®¸æ— é™ recycleï¼ŒStaking å¯ä»¥æ‹¿èµ°æ‰€æœ‰
â””â”€ å¯¼è‡´ Pair æµåŠ¨æ€§å½’é›¶ï¼Œä»·æ ¼å´©ç›˜

1/3 é™åˆ¶:
â””â”€ å³ä½¿è¢«æ“çºµï¼Œä¹Ÿåªèƒ½å½±å“ 1/3 çš„æµåŠ¨æ€§
</code></pre></li>
<li>
<p><strong>å¤šäººå¹¶å‘æç°ä¿æŠ¤</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>æç«¯æƒ…å†µ:
â”œâ”€ 10 ä¸ªç”¨æˆ·åŒæ—¶è§£è´¨æŠ¼
â”œâ”€ Staking éœ€è¦è¿ç»­å–å‡º 10 æ¬¡
â”œâ”€ æ¯æ¬¡å–å‡ºå Pair ä½™é¢å¢åŠ 
â””â”€ ä½† recycle åªèƒ½æ‹¿å› 1/3ï¼Œé˜²æ­¢è€—å°½æ± å­
</code></pre></li>
</ol>
<h3 id="recycle-çš„é™åˆ¶å’Œé£é™©">Recycle çš„é™åˆ¶å’Œé£é™© </h3>
<h4 id="é£é™©-1-æµåŠ¨æ€§ä¸è¶³">é£é™© 1: æµåŠ¨æ€§ä¸è¶³ </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// å¦‚æœ Pair ä¸­ SYI å¤ªå°‘</span>
<span class="token builtin">uint256</span> pairBalance <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> SYI<span class="token punctuation">;</span>  <span class="token comment">// æ± å­å¾ˆæµ…</span>
<span class="token builtin">uint256</span> maxRecyclable <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">333</span> SYI<span class="token punctuation">;</span>  <span class="token comment">// æœ€å¤šå›æ”¶ 33k</span>

<span class="token comment">// ä½† Staking éœ€è¦å›æ”¶ 162,981 SYI</span>
<span class="token function">recycle</span><span class="token punctuation">(</span><span class="token number">162</span><span class="token punctuation">,</span><span class="token number">981</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å®é™…åªèƒ½å›æ”¶ 33,333 SYI âš ï¸</span>

<span class="token comment">// ç»“æœ:</span>
<span class="token comment">// Staking ä½™é¢: 37,019 + 33,333 = 70,352 SYI</span>
<span class="token comment">// ä¾ç„¶ä¸å¤Ÿä¸‹æ¬¡è§£è´¨æŠ¼ä½¿ç”¨ âŒ</span>
</code></pre><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>ç¡®ä¿æµåŠ¨æ€§æ± æ·±åº¦è‡³å°‘æ˜¯ Staking å‚¨å¤‡çš„ 10 å€</li>
<li>ä¾‹å¦‚: Staking 200k SYI â†’ Pair è‡³å°‘ 2M SYI</li>
</ul>
<h4 id="é£é™©-2-å¤§é‡å¹¶å‘æç°">é£é™© 2: å¤§é‡å¹¶å‘æç° </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>10 ä¸ªç”¨æˆ·åŒæ—¶è§£è´¨æŠ¼:
â”œâ”€ Staking åˆå§‹: 200,000 SYI
â”œâ”€ ç¬¬ 1 äºº: å–å‡º 162,981 SYI â†’ recycle â†’ æ¢å¤ 200k âœ…
â”œâ”€ ç¬¬ 2 äºº: å–å‡º 162,981 SYI â†’ recycle â†’ æ¢å¤ 200k âœ…
â”œâ”€ ...
â””â”€ ç¬¬ 10 äºº: å–å‡ºæ—¶ Pair å¯èƒ½å¤ªæµ…ï¼Œrecycle ä¸å¤Ÿ âš ï¸
</code></pre><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>å¢åŠ  Staking åˆå§‹å‚¨å¤‡ï¼ˆä¾‹å¦‚ 500k SYIï¼‰</li>
<li>å®ç°æç°é˜Ÿåˆ—æœºåˆ¶</li>
<li>ç›‘æ§ Pair æµåŠ¨æ€§æ·±åº¦</li>
</ul>
<h4 id="é£é™©-3-ä»·æ ¼æš´è·Œ">é£é™© 3: ä»·æ ¼æš´è·Œ </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>SYI ä»·æ ¼æš´è·Œ 50%:
â”œâ”€ éœ€è¦æ¢å– 1,563 USDT
â”œâ”€ åŸæœ¬éœ€è¦ 162,981 SYI
â””â”€ ç°åœ¨éœ€è¦ 325,962 SYIï¼âŒ

Staking å‚¨å¤‡ä¸å¤Ÿ:
â”œâ”€ åªæœ‰ 200,000 SYI
â””â”€ æ— æ³•å®Œæˆäº¤æ˜“
</code></pre><p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>Staking å‚¨å¤‡åº”è¯¥è€ƒè™‘ä»·æ ¼æ³¢åŠ¨ï¼ˆ2-3 å€å®‰å…¨è¾¹é™…ï¼‰</li>
<li>è®¾ç½®æœ€å¤§å•æ¬¡æç°é™é¢</li>
<li>ç´§æ€¥æš‚åœæœºåˆ¶</li>
</ul>
<hr>
<h2 id="ä¸ä¸»æµ-defi-é¡¹ç›®å¯¹æ¯”">ä¸ä¸»æµ DeFi é¡¹ç›®å¯¹æ¯” </h2>
<h3 id="å¸¸è§çš„è´¨æŠ¼å¥–åŠ±æ¨¡å¼">å¸¸è§çš„è´¨æŠ¼å¥–åŠ±æ¨¡å¼ </h3>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>ä»£è¡¨é¡¹ç›®</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
<th>SYI é‡‡ç”¨?</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é¢„é“¸é€ å¥–åŠ±æ± </strong></td>
<td>Synthetix, Curve</td>
<td>ç®€å•ï¼Œå¯é¢„æµ‹</td>
<td>ä¼šè€—å°½ï¼Œéœ€å®šæœŸè¡¥å……</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>é€šèƒ€é“¸é€ </strong></td>
<td>Compound, Aave</td>
<td>ä¸è€—å°½</td>
<td>æŒç»­é€šèƒ€ï¼Œç¨€é‡ŠæŒå¸è€…</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>äº¤æ˜“è´¹åˆ†çº¢</strong></td>
<td>PancakeSwap</td>
<td>å¯æŒç»­</td>
<td>ä¾èµ–äº¤æ˜“é‡ï¼Œä¸ç¨³å®š</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>Rebase æœºåˆ¶</strong></td>
<td>Ampleforth, OHM</td>
<td>ä¸è€—å°½</td>
<td>ä»·æ ¼å‰§çƒˆæ³¢åŠ¨</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>ğŸ”¥ Recycle æœºåˆ¶</strong></td>
<td><strong>SYI (åˆ›æ–°)</strong></td>
<td>ä¸è€—å°½ï¼Œæ— é€šèƒ€</td>
<td>ä¾èµ–æµåŠ¨æ€§æ·±åº¦</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<h3 id="è¯¦ç»†å¯¹æ¯”">è¯¦ç»†å¯¹æ¯” </h3>
<h4 id="1-synthetix-é¢„é“¸é€ å¥–åŠ±æ± ">1. Synthetix (é¢„é“¸é€ å¥–åŠ±æ± ) </h4>
<p><strong>æœºåˆ¶</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// éƒ¨ç½²æ—¶é¢„å…ˆé“¸é€  1 äº¿ SNX</span>
<span class="token builtin">uint256</span> <span class="token keyword keyword-public">public</span> rewardPool <span class="token operator">=</span> <span class="token number">100</span>_000_000 ether<span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">distributeReward</span><span class="token punctuation">(</span><span class="token builtin">address</span> user<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>rewardPool <span class="token operator">&gt;=</span> amount<span class="token punctuation">,</span> <span class="token string">"Reward pool empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rewardPool <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
    SNX<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>âŒ å¥–åŠ±æ± ä¼šè€—å°½ï¼Œéœ€è¦æ²»ç†æŠ•ç¥¨è¡¥å……</li>
<li>âŒ åˆæœŸéœ€è¦é”å®šå¤§é‡ä»£å¸ï¼ˆæœºä¼šæˆæœ¬é«˜ï¼‰</li>
</ul>
<hr>
<h4 id="2-compound-é€šèƒ€é“¸é€ ">2. Compound (é€šèƒ€é“¸é€ ) </h4>
<p><strong>æœºåˆ¶</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// æ¯ä¸ªåŒºå—åŠ¨æ€é“¸é€ å¥–åŠ±</span>
<span class="token keyword keyword-function">function</span> <span class="token function">distributeReward</span><span class="token punctuation">(</span><span class="token builtin">address</span> user<span class="token punctuation">,</span> <span class="token builtin">uint256</span> blocks<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> reward <span class="token operator">=</span> blocks <span class="token operator">*</span> COMP_PER_BLOCK<span class="token punctuation">;</span>
    COMP<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> reward<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç›´æ¥é“¸é€ æ–°ä»£å¸</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>âŒ æŒç»­é€šèƒ€ï¼Œç¨€é‡Šæ‰€æœ‰æŒå¸è€…</li>
<li>âŒ ä»£å¸ä»·æ ¼é•¿æœŸä¸‹è·Œå‹åŠ›</li>
</ul>
<hr>
<h4 id="3-pancakeswap-äº¤æ˜“è´¹åˆ†çº¢">3. PancakeSwap (äº¤æ˜“è´¹åˆ†çº¢) </h4>
<p><strong>æœºåˆ¶</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// ä»äº¤æ˜“æ‰‹ç»­è´¹ä¸­åˆ†é…</span>
<span class="token keyword keyword-function">function</span> <span class="token function">distributeReward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> feeCollected <span class="token operator">=</span> pair<span class="token punctuation">.</span><span class="token function">feeTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¾‹å¦‚: 1000 USDT</span>
    <span class="token builtin">uint256</span> rewardPerShare <span class="token operator">=</span> feeCollected <span class="token operator">/</span> totalStaked<span class="token punctuation">;</span>
    <span class="token comment">// åˆ†é…ç»™è´¨æŠ¼è€…</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>âŒ ä¾èµ–äº¤æ˜“é‡ï¼Œç†Šå¸‚æ—¶å¥–åŠ±æä½</li>
<li>âŒ ä¸é€‚åˆä¿è¯å›ºå®š APY</li>
</ul>
<hr>
<h4 id="4-syi-recycle-æœºåˆ¶">4. SYI (Recycle æœºåˆ¶) </h4>
<p><strong>æœºåˆ¶</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// 1. ç”¨å‚¨å¤‡çš„ SYI æ¢ USDT</span>
<span class="token function">swapTokensForExactTokens</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. ä»æ± å­å›æ”¶ SYI</span>
<span class="token function">recycle</span><span class="token punctuation">(</span>syiTokensUsed<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. å‚¨å¤‡æ¢å¤ï¼Œå¯ä»¥æ— é™å¾ªç¯</span>
</code></pre><p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>âœ… ä»£å¸å‚¨å¤‡ä¸è€—å°½</li>
<li>âœ… æ— éœ€æŒç»­å¢å‘ï¼ˆæ— é€šèƒ€ï¼‰</li>
<li>âœ… ä¸ä¾èµ–äº¤æ˜“è´¹</li>
<li>âœ… å¯ä»¥ä¿è¯å›ºå®š APY</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>:</p>
<ul>
<li>âš ï¸ ä¾èµ–æµåŠ¨æ€§æ± æ·±åº¦</li>
<li>âš ï¸ å¹¶å‘æç°é£é™©</li>
<li>âš ï¸ ä»·æ ¼æ³¢åŠ¨æ•æ„Ÿ</li>
</ul>
<hr>
<h3 id="ç±»ä¼¼è®¾è®¡å‚è€ƒ">ç±»ä¼¼è®¾è®¡å‚è€ƒ </h3>
<p>è™½ç„¶ Recycle æœºåˆ¶å¾ˆç½•è§ï¼Œä½†æœ‰å‡ ä¸ªé¡¹ç›®æœ‰ç±»ä¼¼æ¦‚å¿µï¼š</p>
<h4 id="liquity---stability-pool">Liquity - Stability Pool </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// ç¨³å®šæ± ä»æ¸…ç®—ä¸­è·åˆ©ï¼Œä½†ä¸ç›´æ¥ä» DEX å›æ”¶</span>
<span class="token keyword keyword-function">function</span> <span class="token function">liquidate</span><span class="token punctuation">(</span><span class="token builtin">address</span> borrower<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> collateral <span class="token operator">=</span> vault<span class="token punctuation">[</span>borrower<span class="token punctuation">]</span><span class="token punctuation">.</span>collateral<span class="token punctuation">;</span>
    stabilityPool<span class="token punctuation">.</span><span class="token function">addCollateral</span><span class="token punctuation">(</span>collateral<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç±»ä¼¼å›æ”¶æ¦‚å¿µ</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>ç›¸ä¼¼ç‚¹</strong>: ä»å¤–éƒ¨ç³»ç»Ÿå›æ”¶èµ„äº§åˆ°å¥–åŠ±æ± <br>
<strong>ä¸åŒç‚¹</strong>: ä¸æ¶‰åŠ DEX æµåŠ¨æ€§æ“ä½œ</p>
<hr>
<h4 id="frax-finance---amo-algorithmic-market-operations">Frax Finance - AMO (Algorithmic Market Operations) </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// AMO å¯ä»¥ä»æ± å­ä¸´æ—¶å–å‡ºèµ„äº§æ“ä½œ</span>
<span class="token keyword keyword-function">function</span> <span class="token function">rebalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> onlyAMO <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> excess <span class="token operator">=</span> pair<span class="token punctuation">.</span><span class="token function">reserve0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> targetReserve<span class="token punctuation">;</span>
    pair<span class="token punctuation">.</span><span class="token function">skim</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> excess<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å–å‡ºå¤šä½™èµ„äº§</span>
    <span class="token comment">// ... æ“ä½œåå†æ”¾å›å»</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>ç›¸ä¼¼ç‚¹</strong>: ä»æµåŠ¨æ€§æ± å–å‡ºèµ„äº§åå†æ”¾å›<br>
<strong>ä¸åŒç‚¹</strong>: ç”¨äºç¨³å®šå¸é”šå®šï¼Œéè´¨æŠ¼å¥–åŠ±</p>
<hr>
<h4 id="olympus-dao---bond-æœºåˆ¶">Olympus DAO - Bond æœºåˆ¶ </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// é€šè¿‡ LP æ“ä½œæ”¯æŒå¥–åŠ±ï¼Œä½†ä¸æ˜¯ç›´æ¥ recycle</span>
<span class="token keyword keyword-function">function</span> <span class="token function">bond</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> lpAmount<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> ohmAmount <span class="token operator">=</span> <span class="token function">calculateBondReward</span><span class="token punctuation">(</span>lpAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    OHM<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> ohmAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä»ç„¶æ˜¯å¢å‘</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>ç›¸ä¼¼ç‚¹</strong>: æ¶‰åŠæµåŠ¨æ€§ç®¡ç†<br>
<strong>ä¸åŒç‚¹</strong>: ä¾ç„¶é€šè¿‡å¢å‘æ”¯ä»˜å¥–åŠ±</p>
<hr>
<h3 id="ç»“è®º">ç»“è®º </h3>
<p><strong>SYI çš„ Recycle æœºåˆ¶æ˜¯ä¸€ä¸ªåˆ›æ–°è®¾è®¡</strong>ï¼Œåœ¨ä¸»æµ DeFi ä¸­å¾ˆå°‘è§åˆ°å®Œå…¨ç›¸åŒçš„å®ç°ã€‚å®ƒæ˜¯ä¸€ç§ï¼š</p>
<ul>
<li><strong>é«˜èµ„é‡‘æ•ˆç‡</strong> çš„è´¨æŠ¼å¥–åŠ±æ–¹æ¡ˆ</li>
<li><strong>é›¶é€šèƒ€</strong> çš„å¯æŒç»­æ¨¡å¼</li>
<li><strong>æµåŠ¨æ€§å‹å¥½</strong> çš„å¾ªç¯ç³»ç»Ÿ</li>
</ul>
<p>ä½†ä¹Ÿéœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ä¸æ˜¯è¡Œä¸šæ ‡å‡†åšæ³•</li>
<li>éœ€è¦ä¸¥æ ¼æµ‹è¯•å’Œç›‘æ§</li>
<li>éœ€è¦å……è¶³çš„æµåŠ¨æ€§æ”¯æ’‘</li>
</ul>
<hr>
<h2 id="å®‰å…¨æ€§åˆ†æ">å®‰å…¨æ€§åˆ†æ </h2>
<h3 id="å®‰å…¨æœºåˆ¶">å®‰å…¨æœºåˆ¶ </h3>
<h4 id="1-æƒé™æ§åˆ¶">1. æƒé™æ§åˆ¶ </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// contracts/SYI/abstract/SYIBase.sol:410</span>
<span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span>staking<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Only staking contract"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>âœ… <strong>é˜²æ­¢</strong>: ä»»æ„åœ°å€è°ƒç”¨ recycle æŠ½å–æµåŠ¨æ€§</p>
<hr>
<h4 id="2-æ•°é‡ä¸Šé™">2. æ•°é‡ä¸Šé™ </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// contracts/SYI/abstract/SYIBase.sol:459</span>
<span class="token builtin">uint256</span> maxRecyclable <span class="token operator">=</span> pairBalance <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token builtin">uint256</span> recycleAmount <span class="token operator">=</span> amount <span class="token operator">&gt;=</span> maxRecyclable <span class="token operator">?</span> maxRecyclable <span class="token punctuation">:</span> amount<span class="token punctuation">;</span>
</code></pre><p>âœ… <strong>é˜²æ­¢</strong>:</p>
<ul>
<li>ä¸€æ¬¡æ€§æŠ½ç©ºæµåŠ¨æ€§</li>
<li>ä»·æ ¼å‰§çƒˆæ³¢åŠ¨</li>
<li>æ¶æ„æ”»å‡»</li>
</ul>
<hr>
<h4 id="3-å‚¨å¤‡é‡åŒæ­¥">3. å‚¨å¤‡é‡åŒæ­¥ </h4>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// contracts/SYI/abstract/SYIBase.sol:497</span>
uniswapV2Pair<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>âœ… <strong>é˜²æ­¢</strong>:</p>
<ul>
<li>balance å’Œ reserve ä¸ä¸€è‡´</li>
<li>AMM ä»·æ ¼è®¡ç®—é”™è¯¯</li>
<li>å¥—åˆ©æ”»å‡»</li>
</ul>
<hr>
<h3 id="é£é™©åœºæ™¯åˆ†æ">é£é™©åœºæ™¯åˆ†æ </h3>
<h4 id="åœºæ™¯-1-æµåŠ¨æ€§æ± è¢«æŠ½ç©º">åœºæ™¯ 1: æµåŠ¨æ€§æ± è¢«æŠ½ç©º </h4>
<p><strong>æ”»å‡»æ­¥éª¤</strong>:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. æ”»å‡»è€…å¤§é‡ä¹°å…¥ SYIï¼ˆæ± å­ SYI å‡å°‘ï¼‰
2. æ­¤æ—¶ Pair ä¸­ SYI ä½™é¢å¾ˆä½
3. æ­£å¸¸ç”¨æˆ·è§£è´¨æŠ¼ï¼Œéœ€è¦ recycle
4. maxRecyclable = pairBalance / 3 â‰ˆ å¾ˆå°‘
5. Staking å‚¨å¤‡æ— æ³•æ¢å¤
</code></pre><p><strong>é˜²æŠ¤æªæ–½</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// 1. é™åˆ¶ 1/3 ä¸Šé™</span>
<span class="token builtin">uint256</span> maxRecyclable <span class="token operator">=</span> pairBalance <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Staking å¢åŠ åˆå§‹å‚¨å¤‡ï¼ˆä¾‹å¦‚ 500k SYIï¼‰</span>
<span class="token comment">// 3. ç›‘æ§æµåŠ¨æ€§æ·±åº¦ï¼Œä½äºé˜ˆå€¼æ—¶æš‚åœè§£è´¨æŠ¼</span>
<span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>pairBalance <span class="token operator">&gt;</span> MIN_LIQUIDITY<span class="token punctuation">,</span> <span class="token string">"Insufficient liquidity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h4 id="åœºæ™¯-2-ä»·æ ¼æ“çºµ">åœºæ™¯ 2: ä»·æ ¼æ“çºµ </h4>
<p><strong>æ”»å‡»æ­¥éª¤</strong>:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. æ”»å‡»è€…é—ªç”µè´·å€Ÿå…¥å¤§é‡ USDT
2. åœ¨ Pair ä¸­ä¹°å…¥ SYIï¼ˆæ¨é«˜ä»·æ ¼ï¼‰
3. å—å®³ç”¨æˆ·è§£è´¨æŠ¼ï¼Œå– SYI æ—¶ä»·æ ¼è™šé«˜
4. recycle æ—¶è·å¾—çš„ SYI å°‘äºé¢„æœŸ
5. æ”»å‡»è€…å½’è¿˜é—ªç”µè´·ï¼Œä»·æ ¼å›è½
</code></pre><p><strong>é˜²æŠ¤æªæ–½</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// 1. ä½¿ç”¨ TWAP (æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼)</span>
<span class="token comment">// 2. é™åˆ¶å•ç¬”äº¤æ˜“æœ€å¤§æ»‘ç‚¹</span>
<span class="token builtin">uint256</span> slippageTolerance <span class="token operator">=</span> <span class="token number">15</span><span class="token operator">%</span><span class="token punctuation">;</span> <span class="token comment">// æœ€å¤§ 15% æ»‘ç‚¹</span>

<span class="token comment">// 3. è®¾ç½®å†·å´æœŸ</span>
<span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>timestamp <span class="token operator">-</span> lastBuyTime<span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">&gt;</span> COOLDOWN<span class="token punctuation">,</span> <span class="token string">"Too frequent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h4 id="åœºæ™¯-3-é‡å…¥æ”»å‡»">åœºæ™¯ 3: é‡å…¥æ”»å‡» </h4>
<p><strong>æ”»å‡»åœºæ™¯</strong>:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. æ¶æ„åˆçº¦è°ƒç”¨ unstake()
2. åœ¨æ¥æ”¶ USDT æ—¶ï¼ˆfallback/receiveï¼‰
3. å†æ¬¡è°ƒç”¨ unstake()
4. å¯èƒ½åœ¨ recycle å‰å¤šæ¬¡å–å‡º SYI
</code></pre><p><strong>é˜²æŠ¤æªæ–½</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// 1. ä½¿ç”¨ Checks-Effects-Interactions æ¨¡å¼</span>
user_record<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// å…ˆä¿®æ”¹çŠ¶æ€</span>
<span class="token function">_update</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å†é”€æ¯ä»£å¸</span>
<span class="token function">IERC20</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> userPayout<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æœ€åè½¬è´¦</span>

<span class="token comment">// 2. ä½¿ç”¨ ReentrancyGuard</span>
<span class="token keyword keyword-import">import</span> <span class="token string">"@openzeppelin/contracts/security/ReentrancyGuard.sol"</span><span class="token punctuation">;</span>
<span class="token keyword keyword-function">function</span> <span class="token function">unstake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> nonReentrant <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><hr>
<h3 id="å»ºè®®çš„ç›‘æ§æŒ‡æ ‡">å»ºè®®çš„ç›‘æ§æŒ‡æ ‡ </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// é“¾ä¸‹ç›‘æ§è„šæœ¬</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">monitorSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. Staking SYI å‚¨å¤‡</span>
    <span class="token keyword keyword-const">const</span> stakingBalance <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> syi<span class="token punctuation">.</span><span class="token method function property-access">balanceOf</span><span class="token punctuation">(</span>staking<span class="token punctuation">.</span><span class="token property-access">address</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>stakingBalance <span class="token operator">&lt;</span> <span class="token constant">MIN_RESERVE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"âš ï¸ Staking reserve too low!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. Pair æµåŠ¨æ€§æ·±åº¦</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>reserve0<span class="token punctuation">,</span> reserve1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> pair<span class="token punctuation">.</span><span class="token method function property-access">getReserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> syiReserve <span class="token operator">=</span> reserve0<span class="token punctuation">;</span>  <span class="token comment">// å‡è®¾ token0 æ˜¯ SYI</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>syiReserve <span class="token operator">&lt;</span> <span class="token constant">MIN_LIQUIDITY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"âš ï¸ Pair liquidity too low!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. å‚¨å¤‡æ¢å¤ç‡</span>
    <span class="token keyword keyword-const">const</span> recycleSuccessRate <span class="token operator">=</span> stakingBalance <span class="token operator">/</span> <span class="token constant">INITIAL_RESERVE</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>recycleSuccessRate <span class="token operator">&lt;</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"âš ï¸ Recycle not working properly!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 4. ä»·æ ¼åç¦»åº¦</span>
    <span class="token keyword keyword-const">const</span> currentPrice <span class="token operator">=</span> reserve1 <span class="token operator">/</span> reserve0<span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> deviation <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">abs</span><span class="token punctuation">(</span>currentPrice <span class="token operator">-</span> expectedPrice<span class="token punctuation">)</span> <span class="token operator">/</span> expectedPrice<span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>deviation <span class="token operator">&gt;</span> <span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"âš ï¸ Price deviation too high!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span>monitorSystem<span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ¯åˆ†é’Ÿæ£€æŸ¥</span>
</code></pre><hr>
<h2 id="å…³é”®ä»£ç ç´¢å¼•">å…³é”®ä»£ç ç´¢å¼• </h2>
<h3 id="æ ¸å¿ƒåˆçº¦æ–‡ä»¶">æ ¸å¿ƒåˆçº¦æ–‡ä»¶ </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>contracts/
â”œâ”€â”€ SYI/
â”‚   â”œâ”€â”€ abstract/
â”‚   â”‚   â””â”€â”€ SYIBase.sol                    # SYI æ ¸å¿ƒé€»è¾‘
â”‚   â”‚       â”œâ”€â”€ recycle()                  # â­ Recycle æœºåˆ¶ (L405-505)
â”‚   â”‚       â””â”€â”€ _update()                  # ä»£å¸è½¬è´¦é€»è¾‘ (L656-687)
â”‚   â””â”€â”€ mainnet/
â”‚       â””â”€â”€ SYI.sol                        # ä¸»ç½‘é…ç½®
â”‚
â””â”€â”€ SYI-Staking/
    â”œâ”€â”€ abstract/
    â”‚   â””â”€â”€ StakingBase.sol                # Staking æ ¸å¿ƒé€»è¾‘
    â”‚       â”œâ”€â”€ unstake()                  # â­ è§£è´¨æŠ¼å…¥å£ (L200-264)
    â”‚       â”œâ”€â”€ _burn()                    # è®¡ç®—å¥–åŠ± (L897-920)
    â”‚       â”œâ”€â”€ _swapSYIForReward()        # â­ å– SYI æ¢ USDT (L922-950)
    â”‚       â”œâ”€â”€ _distributeFriendReward()  # Friend å¥–åŠ± (L999-1012)
    â”‚       â”œâ”€â”€ _distributeTeamReward()    # å›¢é˜Ÿå¥–åŠ± (L1014-1078)
    â”‚       â””â”€â”€ _recordWithdrawal()        # è®°å½•æç° (L1343-1388)
    â””â”€â”€ mainnet/
        â””â”€â”€ Staking.sol                    # ä¸»ç½‘é…ç½®
</code></pre><h3 id="å…³é”®å‡½æ•°è°ƒç”¨é“¾">å…³é”®å‡½æ•°è°ƒç”¨é“¾ </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>ç”¨æˆ·è°ƒç”¨ unstake()
  â””â”€&gt; contracts/SYI-Staking/abstract/StakingBase.sol:200
      â”‚
      â”œâ”€&gt; _burn(stakeIndex)
      â”‚   â””â”€&gt; L897: è®¡ç®—å¥–åŠ±ï¼Œé”€æ¯ sSYI
      â”‚
      â”œâ”€&gt; _swapSYIForReward(calculatedReward)
      â”‚   â””â”€&gt; L922: ç”¨ Staking å‚¨å¤‡çš„ SYI æ¢ USDT
      â”‚       â””â”€&gt; Router.swapTokensForExactTokens(...)
      â”‚
      â”œâ”€&gt; _distributeFriendReward(...)
      â”‚   â””â”€&gt; L999: åˆ†é… 5% ç»™ Friend
      â”‚
      â”œâ”€&gt; _distributeTeamReward(...)
      â”‚   â””â”€&gt; L1014: åˆ†é… 35% ç»™å›¢é˜Ÿ
      â”‚
      â”œâ”€&gt; IERC20(USDT).transfer(msg.sender, userPayout)
      â”‚   â””â”€&gt; L258: è½¬è´¦ USDT ç»™ç”¨æˆ·
      â”‚
      â””â”€&gt; SYI.recycle(syiTokensUsed)
          â””â”€&gt; contracts/SYI/abstract/SYIBase.sol:405
              â”‚
              â”œâ”€&gt; L410: æƒé™æ£€æŸ¥
              â”œâ”€&gt; L448: è·å– Pair çš„ SYI ä½™é¢
              â”œâ”€&gt; L459: è®¡ç®—å®‰å…¨ä¸Šé™ (1/3)
              â”œâ”€&gt; L477: _update(Pair, Staking, recycleAmount)
              â””â”€&gt; L497: Pair.sync() åŒæ­¥å‚¨å¤‡
</code></pre><h3 id="å…³é”®å˜é‡ä½ç½®">å…³é”®å˜é‡ä½ç½® </h3>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// Staking åˆçº¦</span>
contracts<span class="token operator">/</span>SYI<span class="token operator">-</span>Staking<span class="token operator">/</span>abstract<span class="token operator">/</span>StakingBase<span class="token punctuation">.</span>sol
â”œâ”€ L90<span class="token punctuation">:</span>  USDT <span class="token punctuation">(</span>immutable<span class="token punctuation">)</span>
â”œâ”€ L91<span class="token punctuation">:</span>  ROUTER <span class="token punctuation">(</span>immutable<span class="token punctuation">)</span>
â”œâ”€ L98<span class="token punctuation">:</span>  SYI <span class="token punctuation">(</span>å¯è®¾ç½®<span class="token punctuation">)</span>
â”œâ”€ L105<span class="token punctuation">:</span> totalSupply <span class="token punctuation">(</span>sSYI æ€»é‡<span class="token punctuation">)</span>
â”œâ”€ L106<span class="token punctuation">:</span> balances <span class="token punctuation">(</span>ç”¨æˆ· sSYI ä½™é¢<span class="token punctuation">)</span>
â””â”€ L116<span class="token punctuation">:</span> userStakeRecord <span class="token punctuation">(</span>è´¨æŠ¼è®°å½•<span class="token punctuation">)</span>

<span class="token comment">// SYI åˆçº¦</span>
contracts<span class="token operator">/</span>SYI<span class="token operator">/</span>abstract<span class="token operator">/</span>SYIBase<span class="token punctuation">.</span>sol
â”œâ”€ L213<span class="token punctuation">:</span> USDT <span class="token punctuation">(</span>immutable<span class="token punctuation">)</span>
â”œâ”€ L214<span class="token punctuation">:</span> uniswapV2Router <span class="token punctuation">(</span>immutable<span class="token punctuation">)</span>
â”œâ”€ L215<span class="token punctuation">:</span> staking <span class="token punctuation">(</span>immutable<span class="token punctuation">)</span>
â””â”€ L221<span class="token punctuation">:</span> uniswapV2Pair <span class="token punctuation">(</span>å¯è®¾ç½®<span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="å¸¸è§é—®é¢˜-faq">å¸¸è§é—®é¢˜ FAQ </h2>
<h3 id="q1-staking-åˆçº¦éœ€è¦å¤šå°‘-syi-å‚¨å¤‡">Q1: Staking åˆçº¦éœ€è¦å¤šå°‘ SYI å‚¨å¤‡ï¼Ÿ </h3>
<p><strong>ç­”</strong>: å–å†³äºä»¥ä¸‹å› ç´ ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>æœ€å°å‚¨å¤‡è®¡ç®—å…¬å¼:
minReserve = maxStakeAmount Ã— maxAPY Ã— maxConcurrentUnstakes Ã— safetyMargin

ç¤ºä¾‹:
â”œâ”€ maxStakeAmount: 1,000 USDT (å•æ¬¡æœ€å¤§è´¨æŠ¼)
â”œâ”€ maxAPY: 56.31% (30 å¤©æ¡£æœ€é«˜æ”¶ç›Š)
â”œâ”€ maxConcurrentUnstakes: 5 (å‡è®¾æœ€å¤š 5 äººåŒæ—¶æç°)
â”œâ”€ safetyMargin: 2x (è€ƒè™‘ä»·æ ¼æ³¢åŠ¨)
â””â”€ SYI ä»·æ ¼: 0.01 USDT/SYI

è®¡ç®—:
1. å•æ¬¡æœ€å¤§å¥–åŠ±: 1,000 Ã— 1.5631 = 1,563.1 USDT
2. éœ€è¦ SYI: 1,563.1 / 0.01 = 156,310 SYI
3. å¹¶å‘ 5 äºº: 156,310 Ã— 5 = 781,550 SYI
4. å®‰å…¨è¾¹é™…: 781,550 Ã— 2 = 1,563,100 SYI

å»ºè®®å‚¨å¤‡: 1,500,000 - 2,000,000 SYI
</code></pre><p>ä½†ç”±äº <strong>recycle æœºåˆ¶</strong>ï¼Œå®é™…å¯ä»¥æ›´å°‘ï¼š</p>
<ul>
<li>æœ€ä½: 500,000 SYI</li>
<li>æ¨è: 1,000,000 SYI</li>
<li>ä¿å®ˆ: 2,000,000 SYI</li>
</ul>
<hr>
<h3 id="q2-å¦‚æœ-recycle-å¤±è´¥ä¼šæ€æ ·">Q2: å¦‚æœ recycle å¤±è´¥ä¼šæ€æ ·ï¼Ÿ </h3>
<p><strong>å¤±è´¥åœºæ™¯</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// Pair ä¸­ SYI å¤ªå°‘</span>
<span class="token builtin">uint256</span> pairBalance <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span><span class="token number">000</span> SYI<span class="token punctuation">;</span>
<span class="token builtin">uint256</span> maxRecyclable <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span><span class="token number">000</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">666</span> SYI<span class="token punctuation">;</span>

<span class="token comment">// ä½†éœ€è¦å›æ”¶ 162,981 SYI</span>
<span class="token function">recycle</span><span class="token punctuation">(</span><span class="token number">162</span><span class="token punctuation">,</span><span class="token number">981</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å®é™…åªå›æ”¶ 16,666 SYI</span>
</code></pre><p><strong>åæœ</strong>:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Staking ä½™é¢:
â”œâ”€ å–å‡ºå‰: 200,000 SYI
â”œâ”€ å–å‡ºå: 37,019 SYI
â”œâ”€ recycle å: 37,019 + 16,666 = 53,685 SYI âš ï¸
â””â”€ ä¸‹æ¬¡æç°å¯èƒ½ä¸å¤Ÿç”¨

è§£å†³æ–¹æ¡ˆ:
â”œâ”€ 1. å¢åŠ  Staking åˆå§‹å‚¨å¤‡
â”œâ”€ 2. ç¡®ä¿ Pair æµåŠ¨æ€§å……è¶³
â”œâ”€ 3. é™åˆ¶æœ€å¤§è´¨æŠ¼é¢åº¦
â””â”€ 4. å®ç°æç°é˜Ÿåˆ—æœºåˆ¶
</code></pre><hr>
<h3 id="q3-recycle-ä¼šå½±å“-syi-ä»·æ ¼å—">Q3: Recycle ä¼šå½±å“ SYI ä»·æ ¼å—ï¼Ÿ </h3>
<p><strong>ç­”</strong>: ä¼šï¼Œä½†å½±å“å¾ˆå°ã€‚</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>å‡è®¾åˆå§‹çŠ¶æ€:
â”œâ”€ Pair: 4,000,000 SYI + 40,000 USDT
â””â”€ ä»·æ ¼: 40,000 / 4,000,000 = 0.01 USDT/SYI

æ­¥éª¤ 1: å–å‡º SYI
â”œâ”€ Pair: 4,162,981 SYI + 38,436.9 USDT
â”œâ”€ ä»·æ ¼: 38,436.9 / 4,162,981 = 0.00923 USDT/SYI
â””â”€ ä»·æ ¼ä¸‹è·Œ: -7.7% âš ï¸

æ­¥éª¤ 2: Recycle
â”œâ”€ Pair: 4,000,000 SYI + 38,436.9 USDT
â”œâ”€ ä»·æ ¼: 38,436.9 / 4,000,000 = 0.00961 USDT/SYI
â””â”€ ä»·æ ¼å›å‡: +4.1%

æœ€ç»ˆå½±å“:
â”œâ”€ åˆå§‹ä»·æ ¼: 0.01 USDT/SYI
â”œâ”€ æœ€ç»ˆä»·æ ¼: 0.00961 USDT/SYI
â””â”€ å‡€ä¸‹è·Œ: -3.9% (ä»… USDT è¢«å–èµ°çš„å½±å“)
</code></pre><p><strong>å…³é”®ç‚¹</strong>:</p>
<ul>
<li>âœ… Recycle è®© SYI æ•°é‡æ¢å¤ï¼Œä»·æ ¼éƒ¨åˆ†å›å‡</li>
<li>âš ï¸ ä½† USDT è¢«å–èµ°äº†ï¼Œæ‰€ä»¥ä»·æ ¼ä»ä¼šç•¥å¾®ä¸‹è·Œ</li>
<li>âœ… ä¸‹è·Œå¹…åº¦è¿œå°äºæ²¡æœ‰ recycle çš„æƒ…å†µ</li>
</ul>
<hr>
<h3 id="q4-è¿™ä¸ªæœºåˆ¶åˆæ³•åˆè§„å—">Q4: è¿™ä¸ªæœºåˆ¶åˆæ³•/åˆè§„å—ï¼Ÿ </h3>
<p><strong>æŠ€æœ¯è§’åº¦</strong>: å®Œå…¨åˆæ³•ï¼Œè¿™æ˜¯æ™ºèƒ½åˆçº¦çš„æ­£å¸¸é€»è¾‘ã€‚</p>
<p><strong>é£é™©æç¤º</strong>:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>âœ… ä¼˜ç‚¹:
â”œâ”€ ä»£ç å¼€æºï¼Œé€»è¾‘é€æ˜
â”œâ”€ æ²¡æœ‰åé—¨æˆ–æ¶æ„ä»£ç 
â””â”€ ç¬¦åˆ DeFi å»ä¸­å¿ƒåŒ–åŸåˆ™

âš ï¸ æ³¨æ„:
â”œâ”€ ä¸æ˜¯è¡Œä¸šæ ‡å‡†åšæ³•ï¼ˆåˆ›æ–°ä½†æœªç»å¤§è§„æ¨¡éªŒè¯ï¼‰
â”œâ”€ ä¾èµ–æµåŠ¨æ€§æ·±åº¦ï¼ˆéœ€è¦å……è¶³çš„ LPï¼‰
â”œâ”€ éœ€è¦å……åˆ†çš„å®¡è®¡å’Œæµ‹è¯•
â””â”€ å‘ç”¨æˆ·æ¸…æ™°æŠ«éœ²æœºåˆ¶åŸç†
</code></pre><p><strong>å»ºè®®</strong>:</p>
<ol>
<li>è¿›è¡Œä¸“ä¸šçš„æ™ºèƒ½åˆçº¦å®¡è®¡</li>
<li>åœ¨æ–‡æ¡£ä¸­æ¸…æ™°è¯´æ˜ recycle æœºåˆ¶</li>
<li>è¿›è¡Œå……åˆ†çš„æµ‹è¯•ç½‘æµ‹è¯•</li>
<li>é€æ­¥å¢åŠ  TVLï¼Œé¿å…ä¸€æ¬¡æ€§å¤§é‡èµ„é‡‘æ¶Œå…¥</li>
</ol>
<hr>
<h3 id="q5-å¯ä»¥å–æ¶ˆ-recycle-å—">Q5: å¯ä»¥å–æ¶ˆ recycle å—ï¼Ÿ </h3>
<p><strong>å¯ä»¥ï¼Œä½†ä¸æ¨è</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// æ–¹æ¡ˆ A: æ³¨é‡Šæ‰ recycle è°ƒç”¨</span>
<span class="token keyword keyword-function">function</span> <span class="token function">unstake</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> stakeIndex<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... å– SYI æ¢ USDT</span>
    <span class="token comment">// SYI.recycle(syiTokensUsed);  // âŒ ä¸è°ƒç”¨ recycle</span>
<span class="token punctuation">}</span>

<span class="token comment">// åæœ:</span>
<span class="token comment">// â”œâ”€ Staking å‚¨å¤‡ä¼šé€æ¸è€—å°½</span>
<span class="token comment">// â””â”€ éœ€è¦å®šæœŸæ‰‹åŠ¨è¡¥å…… SYI</span>
</code></pre><p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity solidity"><code><span class="token comment">// æ–¹æ¡ˆ B: æ”¹ä¸ºé€šèƒ€æ¨¡å¼</span>
<span class="token keyword keyword-function">function</span> <span class="token function">unstake</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> stakeIndex<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... è®¡ç®—å¥–åŠ±</span>

    <span class="token comment">// ä¸å– SYIï¼Œç›´æ¥é“¸é€  USDTï¼ˆå¦‚æœæ˜¯ç¨³å®šå¸é¡¹ç›®ï¼‰</span>
    USDT<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> calculatedReward<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// æˆ–è€…ä»å¥–åŠ±æ± è½¬è´¦</span>
    USDT<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>rewardPool<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> calculatedReward<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>ç»“è®º</strong>: Recycle æ˜¯è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå–æ¶ˆåéœ€è¦é‡æ–°è®¾è®¡æ•´ä¸ªå¥–åŠ±åˆ†é…é€»è¾‘ã€‚</p>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“ </h2>
<h3 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹ </h3>
<ol>
<li><strong>Staking åˆçº¦æœ‰ SYI å‚¨å¤‡</strong> (å¿…é¡»é¢„å……å€¼)</li>
<li><strong>è§£è´¨æŠ¼æ—¶ç”¨å‚¨å¤‡å– SYI æ¢ USDT</strong> (æ”¯ä»˜å¥–åŠ±)</li>
<li><strong>Recycle ä» Pair å›æ”¶ SYI</strong> (æ¢å¤å‚¨å¤‡)</li>
<li><strong>å‚¨å¤‡å¾ªç¯ä½¿ç”¨ï¼Œç†è®ºä¸Šæ°¸ä¸è€—å°½</strong> â™¾ï¸</li>
</ol>
<h3 id="åˆ›æ–°ç‚¹">åˆ›æ–°ç‚¹ </h3>
<ul>
<li>âœ… <strong>é›¶é€šèƒ€</strong>: ä¸éœ€è¦å¢å‘ä»£å¸</li>
<li>âœ… <strong>é«˜æ•ˆç‡</strong>: èµ„é‡‘å¾ªç¯åˆ©ç”¨</li>
<li>âœ… <strong>å¯æŒç»­</strong>: ä¸ä¾èµ–äº¤æ˜“è´¹æˆ–å¤–éƒ¨æ”¶å…¥</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹ </h3>
<ul>
<li>âš ï¸ <strong>ä¾èµ–æµåŠ¨æ€§</strong>: éœ€è¦å……è¶³çš„ Pair æ·±åº¦</li>
<li>âš ï¸ <strong>å¹¶å‘é£é™©</strong>: å¤§é‡åŒæ—¶æç°å¯èƒ½å¯¼è‡´å‚¨å¤‡ä¸è¶³</li>
<li>âš ï¸ <strong>ä»·æ ¼æ•æ„Ÿ</strong>: ä»·æ ¼æš´è·Œä¼šå¢åŠ  SYI æ¶ˆè€—</li>
</ul>
<h3 id="æ¨èé…ç½®">æ¨èé…ç½® </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>æœ€ä½é…ç½®:
â”œâ”€ Staking å‚¨å¤‡: 500,000 SYI
â””â”€ Pair æµåŠ¨æ€§: 5,000,000 SYI + 50,000 USDT

æ¨èé…ç½®:
â”œâ”€ Staking å‚¨å¤‡: 1,000,000 SYI
â””â”€ Pair æµåŠ¨æ€§: 10,000,000 SYI + 100,000 USDT

ä¿å®ˆé…ç½®:
â”œâ”€ Staking å‚¨å¤‡: 2,000,000 SYI
â””â”€ Pair æµåŠ¨æ€§: 20,000,000 SYI + 200,000 USDT
</code></pre><hr>
<h2 id="é™„å½•">é™„å½• </h2>
<h3 id="å®Œæ•´è°ƒç”¨ç¤ºä¾‹">å®Œæ•´è°ƒç”¨ç¤ºä¾‹ </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// JavaScript æµ‹è¯•è„šæœ¬</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"hardhat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">testUnstakeWithRecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> ethers<span class="token punctuation">.</span><span class="token method function property-access">getSigners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1. æŸ¥è¯¢åˆå§‹çŠ¶æ€</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"=== åˆå§‹çŠ¶æ€ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> stakingBalance <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> syi<span class="token punctuation">.</span><span class="token method function property-access">balanceOf</span><span class="token punctuation">(</span>staking<span class="token punctuation">.</span><span class="token property-access">address</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>reserve0<span class="token punctuation">,</span> reserve1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> pair<span class="token punctuation">.</span><span class="token method function property-access">getReserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Staking SYI: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>stakingBalance<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Pair SYI: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>reserve0<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Pair USDT: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>reserve1<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. æ‰§è¡Œè§£è´¨æŠ¼</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"\n=== æ‰§è¡Œè§£è´¨æŠ¼ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> tx <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> staking<span class="token punctuation">.</span><span class="token method function property-access">unstake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> receipt <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> tx<span class="token punctuation">.</span><span class="token method function property-access">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. æŸ¥è¯¢æœ€ç»ˆçŠ¶æ€</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"\n=== æœ€ç»ˆçŠ¶æ€ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> stakingBalanceAfter <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> syi<span class="token punctuation">.</span><span class="token method function property-access">balanceOf</span><span class="token punctuation">(</span>staking<span class="token punctuation">.</span><span class="token property-access">address</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>reserve0After<span class="token punctuation">,</span> reserve1After<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> pair<span class="token punctuation">.</span><span class="token method function property-access">getReserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Staking SYI: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>stakingBalanceAfter<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Pair SYI: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>reserve0After<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Pair USDT: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">formatEther</span><span class="token punctuation">(</span>reserve1After<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4. éªŒè¯ recycle æ•ˆæœ</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"\n=== Recycle æ•ˆæœ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Staking å‚¨å¤‡æ¢å¤: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stakingBalance<span class="token punctuation">.</span><span class="token method function property-access">eq</span><span class="token punctuation">(</span>stakingBalanceAfter<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'âœ…'</span> <span class="token operator">:</span> <span class="token string">'âŒ'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Pair SYI æ¢å¤: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reserve0<span class="token punctuation">.</span><span class="token method function property-access">eq</span><span class="token punctuation">(</span>reserve0After<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'âœ…'</span> <span class="token operator">:</span> <span class="token string">'âš ï¸ æœ‰å·®å¼‚'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">testUnstakeWithRecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="ç›¸å…³æ–‡æ¡£">ç›¸å…³æ–‡æ¡£ </h3>
<ul>
<li><a href="./SYI-Recycle%E6%9C%BA%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE.md">SYI-Recycleæœºåˆ¶æµç¨‹å›¾.md</a> - å›¾å½¢åŒ–æµç¨‹è¯´æ˜</li>
<li><a href="./%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.md">åˆçº¦éƒ¨ç½²æŒ‡å—.md</a> - éƒ¨ç½²å’Œé…ç½®è¯´æ˜</li>
<li><a href="./%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E6%96%87%E6%A1%A3.md">æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£.md</a> - å®Œæ•´æµ‹è¯•åœºæ™¯</li>
</ul>
<hr>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>: v1.0<br>
<strong>æœ€åæ›´æ–°</strong>: 2025-01-XX<br>
<strong>ç»´æŠ¤è€…</strong>: Development Team</p>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>